<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è¿˜åŸæµ‹è¯• - OCM</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1000px;
            margin: 0 auto;
            backdrop-filter: blur(10px);
        }
        h1 {
            color: #333;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
        }
        .section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin: 0.5rem;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }
        .result {
            background: #fff;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        .error {
            border-left-color: #e74c3c;
            background: #fdf2f2;
        }
        .success {
            border-left-color: #2ecc71;
            background: #f2fdf2;
        }
        select, input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0.5rem;
            min-width: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ OpenClaw æ™ºèƒ½è¿˜åŸæµ‹è¯•ç³»ç»Ÿ</h1>
        
        <div class="section">
            <h2>1. è¯Šæ–­èŠ‚ç‚¹æ•…éšœ</h2>
            <select id="nodeSelect">
                <option value="baota">å®å¡”æœåŠ¡å™¨ (baota)</option>
                <option value="t440">T440å·¥ä½œæœåŠ¡å™¨ (t440)</option>
                <option value="pc-a">PC-Aä¸»æœº (pc-a)</option>
            </select>
            <button class="btn" onclick="diagnoseNode()">ğŸ” è¯Šæ–­æ•…éšœ</button>
            <div id="diagnoseResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="section">
            <h2>2. æŸ¥çœ‹å¯ç”¨å¤‡ä»½</h2>
            <button class="btn" onclick="listBackups()">ğŸ“‹ åˆ—å‡ºå¤‡ä»½</button>
            <div id="backupsList" class="result" style="display:none;"></div>
        </div>
        
        <div class="section">
            <h2>3. æ‰§è¡Œæ™ºèƒ½è¿˜åŸ</h2>
            <input type="number" id="backupId" placeholder="å¤‡ä»½ID" min="1">
            <select id="strategySelect">
                <option value="">è‡ªåŠ¨é€‰æ‹©ç­–ç•¥</option>
                <option value="config_only">ä»…è¿˜åŸé…ç½®</option>
                <option value="service_restart">æœåŠ¡é‡å¯</option>
                <option value="full_restore">å®Œæ•´è¿˜åŸ</option>
                <option value="reinstall">é‡æ–°å®‰è£…</option>
                <option value="emergency">ç´§æ€¥ä¿®å¤</option>
            </select>
            <button class="btn btn-success" onclick="executeRestore()">ğŸš€ æ‰§è¡Œè¿˜åŸ</button>
            <div id="restoreResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="section">
            <h2>4. å¿«é€Ÿæµ‹è¯•</h2>
            <button class="btn btn-danger" onclick="breakConfig()">ğŸ’¥ æ•…æ„ç ´åå®å¡”é…ç½®</button>
            <button class="btn btn-success" onclick="quickRestore()">âš¡ å¿«é€Ÿè¿˜åŸ</button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://192.168.3.33:8001/api';
        
        async function diagnoseNode() {
            const node = document.getElementById('nodeSelect').value;
            const resultDiv = document.getElementById('diagnoseResult');
            
            try {
                const response = await fetch(`${API_BASE}/nodes/${node}/diagnose-simple`);
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `è¯Šæ–­ç»“æœ:
æ•…éšœç±»å‹: ${result.failure_type}
æ•…éšœè¯¦æƒ…: ${JSON.stringify(result.details, null, 2)}
æ¨èç­–ç•¥: ${result.recommended_strategy}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `è¯Šæ–­å¤±è´¥: ${result.error}`;
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `è¯·æ±‚å¤±è´¥: ${error.message}`;
                resultDiv.style.display = 'block';
            }
        }
        
        async function listBackups() {
            const node = document.getElementById('nodeSelect').value;
            const resultDiv = document.getElementById('backupsList');
            
            try {
                const response = await fetch(`${API_BASE}/nodes/${node}/restore-simple-simple`);
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    if (result.backups && result.backups.length > 0) {
                        resultDiv.textContent = `å¯ç”¨å¤‡ä»½ (${result.backups.length}ä¸ª):
${result.backups.map(b => `ID ${b.id}: ${b.filename} (${b.type}) - ${b.date}`).join('\\n')}`;
                    } else {
                        resultDiv.textContent = 'æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„å¤‡ä»½';
                    }
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `è·å–å¤‡ä»½å¤±è´¥: ${result.error}`;
                }
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `è¯·æ±‚å¤±è´¥: ${error.message}`;
                resultDiv.style.display = 'block';
            }
        }
        
        async function executeRestore() {
            const node = document.getElementById('nodeSelect').value;
            const backupId = document.getElementById('backupId').value;
            const strategy = document.getElementById('strategySelect').value;
            const resultDiv = document.getElementById('restoreResult');
            
            if (!backupId) {
                alert('è¯·è¾“å…¥å¤‡ä»½ID');
                return;
            }
            
            resultDiv.textContent = 'æ­£åœ¨æ‰§è¡Œè¿˜åŸï¼Œè¯·ç¨å€™...';
            resultDiv.className = 'result';
            resultDiv.style.display = 'block';
            
            try {
                const payload = { backup_id: parseInt(backupId) };
                if (strategy) payload.strategy = strategy;
                
                const response = await fetch(`${API_BASE}/nodes/${node}/restore-simple`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `è¿˜åŸæˆåŠŸ! 
æ¶ˆæ¯: ${result.message}
ç­–ç•¥: ${result.strategy}
æ•…éšœç±»å‹: ${result.failure_type}
éªŒè¯ç»“æœ: ${JSON.stringify(result.verification, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `è¿˜åŸå¤±è´¥: ${result.error || result.message}
${result.details ? 'Details: ' + result.details : ''}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `è¯·æ±‚å¤±è´¥: ${error.message}`;
            }
        }
        
        async function breakConfig() {
            if (!confirm('ç¡®å®šè¦æ•…æ„ç ´åå®å¡”é…ç½®ç”¨äºæµ‹è¯•å—ï¼Ÿ')) return;
            
            alert('âš ï¸ è¿™ä¸ªåŠŸèƒ½éœ€è¦æ‰‹åŠ¨æ‰§è¡ŒSSHå‘½ä»¤æ¥ç ´åé…ç½®ã€‚\\næµ‹è¯•å®Œæˆåè¯·ä½¿ç”¨"å¿«é€Ÿè¿˜åŸ"ä¿®å¤ã€‚');
        }
        
        async function quickRestore() {
            document.getElementById('nodeSelect').value = 'baota';
            document.getElementById('backupId').value = '133';
            document.getElementById('strategySelect').value = 'config_only';
            
            await executeRestore();
        }
    </script>
</body>
</html>